<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DAA Portfolio — Tejas B. Keri</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;800&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Prism for syntax highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

<style>
/* -----------------------------
   THEME VARIABLES
   ----------------------------- */
:root{
  --bg:#071025;
  --panel:#0b1530;
  --muted:#9aa6bf;
  --accent:#22d3ee;
  --accent-2:#0891b2;
  --glass: rgba(255,255,255,0.04);
  --card-shadow: 0 10px 30px rgba(2,6,23,0.6);
  --radius: 14px;
  --trans-fast: 160ms;
  --trans: 220ms;
  --trans-slow: 360ms;
  --glow: 0 10px 30px rgba(34,211,238,0.06);
}
.light {
  --bg: #f4f7fb;
  --panel: #ffffff;
  --muted: #475569;
  --accent: #0ea5e9;
  --glass: rgba(2,6,23,0.04);
  --card-shadow: 0 8px 22px rgba(16,24,40,0.08);
}

/* -----------------------------
   BASE PAGE
   ----------------------------- */
html,body{
  height:100%;
  margin:0;
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg, #041022 0%, #071025 40%, #071025 100%);
  color: #e6eef8;
  transition: background var(--trans-slow) ease, color var(--trans-slow) ease;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
  -webkit-tap-highlight-color: transparent;
}

/* -----------------------------
   HEADER
   ----------------------------- */
.top {
  max-width:1200px;
  margin:28px auto 12px;
  padding:18px;
  border-radius:18px;
  background: linear-gradient(90deg, rgba(16,36,59,0.85) 0%, rgba(17,44,62,0.75) 100%);
  box-shadow: var(--card-shadow);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:20px;
  backdrop-filter: blur(6px) saturate(120%);
}
.top-left h1{ margin:0; font-size:20px; color:#def4ff; letter-spacing: -0.2px; }
.badges{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.badge{
  background: rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.04);
  padding:6px 10px;
  font-size:12px;
  color:var(--muted);
  border-radius:999px;
}
.badge strong{ color:#fff; margin-right:6px; font-weight:600; }
.top-right{ display:flex; align-items:center; gap:14px; }
.home-btn{
  padding:10px 16px;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#022430;
  font-weight:700;
  border-radius:999px;
  text-decoration:none;
  box-shadow: 0 6px 18px rgba(2, 27, 37, 0.25);
}

/* -----------------------------
   LAYOUT
   ----------------------------- */
.container {
  max-width:1200px;
  margin:18px auto 60px;
  display:grid;
  grid-template-columns: 1fr 2fr;
  gap:20px;
  align-items:start;
  padding: 0 12px;
}
@media (max-width: 980px){
  .container { grid-template-columns: 1fr; }
}

/* -----------------------------
   SIDEBAR (single column cards)
   ----------------------------- */
.sidebar{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:var(--radius);
  padding:14px;
  height:72vh;
  overflow:auto;
  box-shadow: var(--card-shadow);
  position:relative;
}

/* search and controls */
.controls {
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:12px;
}
.search {
  flex:1;
  display:flex;
  align-items:center;
  gap:8px;
  background: rgba(255,255,255,0.02);
  padding:8px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.03);
  color:var(--muted);
}
.search input{
  background:transparent;
  border:0;
  outline:0;
  color:inherit;
  width:100%;
  font-size:13px;
}
.controls .count {
  font-size:13px;
  color:var(--muted);
  padding:6px 10px;
  border-radius:8px;
  background: rgba(255,255,255,0.01);
}

/* force single column list of cards */
.cards-list{
  display:grid;
  grid-template-columns: 1fr; /* SINGLE COLUMN */
  gap:14px;
  margin-top:6px;
}

/* -----------------------------
   PROBLEM CARD (single-row, elevated)
   ----------------------------- */
.problem-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px;
  padding:14px;
  cursor:pointer;
  color:var(--muted);
  transition: transform var(--trans) cubic-bezier(.2,.9,.3,1), box-shadow var(--trans), background var(--trans);
  border:1px solid rgba(255,255,255,0.02);
  display:flex;
  gap:12px;
  align-items:flex-start;
  min-height:92px;
  position:relative;
  overflow:hidden;
  outline: none;
}
.problem-card::before{
  content: '';
  position:absolute;
  inset:0;
  pointer-events:none;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  border-radius:12px;
}
.problem-card .index {
  min-width:44px;
  height:44px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-family:"JetBrains Mono", monospace;
  color:#def4ff;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: var(--glow);
  flex-shrink:0;
}
.problem-card .body {
  flex:1;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.problem-card h4{ margin:0; font-size:15px; color:#e9fbff; line-height:1.1; }
.problem-card .meta {
  font-size:13px;
  color:var(--muted);
  display:flex;
  justify-content:space-between;
  gap:8px;
  align-items:center;
}
.problem-card .preview {
  margin-top:6px;
  font-family: "JetBrains Mono", monospace;
  font-size:12px;
  color:var(--muted);
  background: rgba(0,0,0,0.02);
  padding:8px 10px;
  border-radius:8px;
  max-width:100%;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.problem-card .sdg-chips {
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-top:6px;
}
.sdg-chip {
  background: rgba(34,211,238,0.06);
  color: #cdf6ff;
  padding:4px 8px;
  font-size:11px;
  border-radius:999px;
  border:1px solid rgba(34,211,238,0.06);
}

/* hover lift + glow */
.problem-card:hover{
  transform: translateY(-10px) scale(1.01);
  box-shadow: 0 22px 44px rgba(2,6,23,0.6), 0 6px 30px rgba(34,211,238,0.05);
  background: linear-gradient(180deg, rgba(7,28,45,0.6), rgba(8,18,30,0.55));
  color:#eafcff;
}
.problem-card:active{
  transform: translateY(-3px) scale(0.998);
}

/* active card indicator */
.problem-card.active {
  box-shadow: 0 24px 48px rgba(2,6,23,0.65), 0 8px 40px rgba(34,211,238,0.12);
  border: 1px solid rgba(34,211,238,0.16);
  background: linear-gradient(90deg, rgba(6,182,212,0.06), rgba(7,125,170,0.03));
  color:#eafcff;
}

/* -----------------------------
   CENTER PANEL (DETAILS + CODE)
   ----------------------------- */
.center{
  background: linear-gradient(180deg, rgba(10,20,45,0.72), rgba(8,16,32,0.78));
  border-radius:var(--radius);
  padding:22px;
  min-height:72vh;
  overflow:auto;
  box-shadow:var(--card-shadow);
}
.center h2{ margin-top:0; font-size:20px; color:#dff8ff; }
.center .desc { color:var(--muted); margin:10px 0 12px; font-size:14px; }
.center .complexity { font-size:13px; color:var(--muted); margin-bottom:14px; }
.center .sdg-row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:14px; }
.center .sdg-row .sdg-chip { background: rgba(34,211,238,0.09); color:#e6fbff; padding:6px 10px; font-size:12px; border-radius:999px; border:1px solid rgba(34,211,238,0.08); }
pre { background:#0f1724 !important; padding:18px; border-radius:12px; overflow:auto; }
code { font-family:"JetBrains Mono", monospace; font-size:14px; display:block; white-space:pre; color:#cbeefc; }

/* small responsive tweaks */
@media (max-width: 720px){
  .problem-card { min-height:84px; padding:12px; gap:10px; }
  .problem-card .index { min-width:40px; height:40px; }
  .center { padding:16px; }
}

/* accessibility helper */
.sr-only{
  position:absolute!important;
  height:1px;width:1px;
  overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="top" role="banner">
  <div class="top-left">
    <h1>Smart City Infrastructure & Routing Design — DAA Portfolio</h1>
    <div class="badges" aria-hidden="true">
      <span class="badge"><strong>Student:</strong> TEJAS.B.KERI</span>
      <span class="badge"><strong>Faculty:</strong> Prakash Hegade</span>
      <span class="badge"><strong>Course:</strong> Design & Analysis of Algorithms</span>
      <span class="badge"><strong>Focus:</strong> Land Use & Location Optimization</span>
    </div>
  </div>
  <div class="top-right">
    <span class="meta-pill">2024 · DAA City Design</span>
    <a class="home-btn" href="#">← Back to Home</a>
  </div>
</div>

<!-- MAIN LAYOUT -->
<div class="container" role="main">
  <!-- SIDEBAR: cards list -->
  <aside class="sidebar" aria-label="Problem gallery">
    <div class="controls" aria-hidden="false">
      <div class="search" role="search" aria-label="Search problems">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="opacity:0.9"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" type="text" placeholder="Search problems (title, id, SDG)..." aria-label="Search problems" />
      </div>
      <div class="count" id="count">10 items</div>
    </div>

    <h3 style="margin:6px 0 8px;color:#e6f7ff">A. Case Study Gallery</h3>
    <p style="color:var(--muted); font-size:13px; margin-top:0;">Click a card to view description, SDGs & code in the right panel.</p>

    <div id="problemList" class="cards-list" tabindex="0"></div>
  </aside>

  <!-- CENTER content -->
  <main class="center" id="center" tabindex="0">
    <h2 id="problemTitle">Select a problem from the left</h2>
    <div class="desc" id="problemDesc">Click a problem card to view the explanation.</div>
    <div class="sdg-row" id="problemSdgs" aria-hidden="true"></div>
    <div class="complexity" id="problemComplexity">Time Complexity — (select a problem)</div>
    <pre aria-live="polite"><code id="problemCode" class="language-python"># Code will appear here.</code></pre>
  </main>
</div>

<script>
/* ----------------------------------------------------
   PROBLEM DATA (with SDGs added)
   - Each problem now has an `sdgs` array (3-4 short labels)
---------------------------------------------------- */
const problems = [
  {
    id: 1,
    title: "Optimal Hospital Location",
    desc: "Place hospitals so that the total distance citizens travel is minimized.",
    complexity: "O(n log n) using median method; O(knt) for k-median clustering.",
    sdgs: ["SDG 3: Good Health", "SDG 9: Industry & Infrastructure", "SDG 11: Sustainable Cities", "SDG 10: Reduced Inequalities"],
    code: `# Hospital Location (Median / k-median)
# 1D Median solution
def median_1d(points):
    points = sorted(points)
    n = len(points)
    if n % 2:
        return points[n//2]
    return (points[n//2-1] + points[n//2]) / 2

# Example usage:
if __name__ == "__main__":
    pts = [1, 5, 9, 3, 8]
    print("Median:", median_1d(pts))`
  },
  {
    id: 2,
    title: "School Allocation to Students",
    desc: "Assign students to the nearest school under capacity constraints using Max-Flow.",
    complexity: "O(E √V) using Dinic’s Algorithm.",
    sdgs: ["SDG 4: Quality Education", "SDG 10: Reduced Inequalities", "SDG 11: Sustainable Cities"],
    code: `# Max Flow based School Allocation (Dinic)
from collections import deque

class Dinic:
    def __init__(self, n):
        self.n = n
        self.adj = [[] for _ in range(n)]

    def add_edge(self, u, v, cap):
        self.adj[u].append([v, cap, len(self.adj[v])])
        self.adj[v].append([u, 0, len(self.adj[u]) - 1])

    def bfs_level(self, s, t, level):
        q = deque([s])
        level[:] = [-1]*self.n
        level[s] = 0
        while q:
            u = q.popleft()
            for v, cap, rev in self.adj[u]:
                if cap > 0 and level[v] < 0:
                    level[v] = level[u] + 1
                    q.append(v)
        return level[t] >= 0

    def dfs_flow(self, u, t, f, level, it):
        if u == t:
            return f
        for i in range(it[u], len(self.adj[u])):
            v, cap, rev = self.adj[u][i]
            if cap > 0 and level[v] == level[u] + 1:
                ret = self.dfs_flow(v, t, min(f, cap), level, it)
                if ret > 0:
                    self.adj[u][i][1] -= ret
                    self.adj[v][self.adj[u][i][2]][1] += ret
                    return ret
            it[u] += 1
        return 0

    def max_flow(self, s, t):
        flow = 0
        level = [-1]*self.n
        while self.bfs_level(s, t, level):
            it = [0]*self.n
            while True:
                f = self.dfs_flow(s, t, 10**18, level, it)
                if f == 0: break
                flow += f
        return flow

# (Integrate your full allocation construction here.)`
  },
  {
    id: 3,
    title: "Smart Parking Slot Allocation",
    desc: "Assign cars to slots minimizing walking distance using Hungarian Algorithm.",
    complexity: "O(n³)",
    sdgs: ["SDG 11: Sustainable Cities", "SDG 9: Industry & Infrastructure", "SDG 13: Climate Action"],
    code: `# Hungarian Algorithm (assignment)
def hungarian(cost):
    # cost: n x n matrix
    n = len(cost)
    u = [0]*(n+1)
    v = [0]*(n+1)
    p = [0]*(n+1)
    way = [0]*(n+1)
    for i in range(1, n+1):
        p[0] = i
        j0 = 0
        minv = [float('inf')] * (n+1)
        used = [False] * (n+1)
        while True:
            used[j0] = True
            i0 = p[j0]
            delta = float('inf')
            j1 = 0
            for j in range(1, n+1):
                if not used[j]:
                    cur = cost[i0-1][j-1] - u[i0] - v[j]
                    if cur < minv[j]:
                        minv[j] = cur
                        way[j] = j0
                    if minv[j] < delta:
                        delta = minv[j]
                        j1 = j
            for j in range(0, n+1):
                if used[j]:
                    u[p[j]] += delta
                    v[j] -= delta
                else:
                    minv[j] -= delta
            j0 = j1
            if p[j0] == 0:
                break
        while True:
            j1 = way[j0]
            p[j0] = p[j1]
            j0 = j1
            if j0 == 0:
                break
    # result in p
    ans = [-1]*n
    for j in range(1, n+1):
        if p[j] != 0:
            ans[p[j]-1] = j-1
    return ans`
  },
  {
    id: 4,
    title: "Industrial vs Residential Separation",
    desc: "Color blocks ensuring industries do not touch residential regions.",
    complexity: "O(V+E) for bipartite check.",
    sdgs: ["SDG 11: Sustainable Cities", "SDG 3: Good Health", "SDG 12: Responsible Consumption"],
    code: `# Graph bipartite check
from collections import deque

def is_bipartite(graph):
    n = len(graph)
    color = [-1]*n
    for i in range(n):
        if color[i] != -1: continue
        q = deque([i])
        color[i] = 0
        while q:
            u = q.popleft()
            for v in graph[u]:
                if color[v] == -1:
                    color[v] = color[u]^1
                    q.append(v)
                elif color[v] == color[u]:
                    return False
    return True`
  },
  {
    id: 5,
    title: "Public Park Placement Optimization",
    desc: "Select park sites to maximize population coverage using greedy + Fenwick Tree.",
    complexity: "O(k n log n)",
    sdgs: ["SDG 11: Sustainable Cities", "SDG 3: Good Health", "SDG 15: Life on Land"],
    code: `# Fenwick Tree structure (Binary Indexed Tree)
class Fenwick:
    def __init__(self, n):
        self.n = n
        self.bit = [0]*(n+1)

    def add(self, idx, val):
        i = idx+1
        while i <= self.n:
            self.bit[i] += val
            i += i & -i

    def sum(self, idx):
        res = 0
        i = idx+1
        while i > 0:
            res += self.bit[i]
            i -= i & -i
        return res`
  },
  {
    id: 6,
    title: "Land Subdivision Optimization",
    desc: "Divide land into balanced subplots using recursive kd-like partitioning.",
    complexity: "O(n log n)",
    sdgs: ["SDG 11: Sustainable Cities", "SDG 15: Life on Land", "SDG 8: Decent Work"],
    code: `# Polygon area via Shoelace
def polygon_area(poly):
    s = 0
    n = len(poly)
    for i in range(n):
        x1,y1 = poly[i]
        x2,y2 = poly[(i+1)%n]
        s += x1*y2 - x2*y1
    return abs(s)/2`
  },
  {
    id: 7,
    title: "High Footfall Commercial Zone Prediction",
    desc: "Predict high footfall zones using clustering + movement density.",
    complexity: "O(nk) per iteration",
    sdgs: ["SDG 8: Decent Work & Economic Growth", "SDG 11: Sustainable Cities", "SDG 9: Industry & Innovation"],
    code: `# Simple clustering logic example (k-means like)
def assign(points, centers):
    clusters = [[] for _ in centers]
    for p in points:
        best = 0
        bestd = float('inf')
        for i,c in enumerate(centers):
            d = (p[0]-c[0])**2 + (p[1]-c[1])**2
            if d < bestd:
                bestd = d; best = i
        clusters[best].append(p)
    return clusters`
  },
  {
    id: 8,
    title: "Creation of Green Belt Buffers",
    desc: "Use BFS/DFS layers to form multi-zone buffer around polluted areas.",
    complexity: "O(V+E)",
    sdgs: ["SDG 3: Good Health", "SDG 11: Sustainable Cities", "SDG 13: Climate Action", "SDG 15: Life on Land"],
    code: `# BFS buffer layers
from collections import deque

def buffer_layers(grid, sources):
    n = len(grid); m = len(grid[0])
    dist = [[-1]*m for _ in range(n)]
    q = deque()
    for (r,c) in sources:
        dist[r][c] = 0; q.append((r,c))
    dirs = [(1,0),(-1,0),(0,1),(0,-1)]
    while q:
        r,c = q.popleft()
        for dr,dc in dirs:
            nr,nc = r+dr, c+dc
            if 0<=nr<n and 0<=nc<m and dist[nr][nc] == -1:
                dist[nr][nc] = dist[r][c] + 1
                q.append((nr,nc))
    return dist`
  },
  {
    id: 9,
    title: "Footpath Connectivity Plan",
    desc: "Model nodes as junctions and compute shortest safe routes.",
    complexity: "Dijkstra — O(E log V)",
    sdgs: ["SDG 11: Sustainable Cities", "SDG 3: Good Health", "SDG 9: Industry & Infrastructure"],
    code: `# Dijkstra Shortest Path
import heapq

def dijkstra(graph, start):
    dist = {v: float('inf') for v in graph}
    dist[start] = 0
    h = [(0, start)]
    while h:
        d, u = heapq.heappop(h)
        if d > dist[u]: continue
        for v,w in graph[u]:
            nd = d + w
            if nd < dist[v]:
                dist[v] = nd
                heapq.heappush(h, (nd, v))
    return dist`
  },
  {
    id: 10,
    title: "Underground Utility Routing",
    desc: "Plan underground cables avoiding obstacles using A*.",
    complexity: "O(E log V)",
    sdgs: ["SDG 9: Industry & Infrastructure", "SDG 11: Sustainable Cities", "SDG 6: Clean Water & Sanitation"],
    code: `# A* Search
import heapq

def heuristic(a,b):
    return abs(a[0]-b[0]) + abs(a[1]-b[1])

def astar(grid, start, goal):
    n,m = len(grid), len(grid[0])
    open_set = [(heuristic(start, goal), 0, start)]
    gscore = {start:0}
    came_from = {}
    while open_set:
        _, cost, cur = heapq.heappop(open_set)
        if cur == goal:
            path = []
            while cur in came_from:
                path.append(cur)
                cur = came_from[cur]
            return path[::-1]
        for dr,dc in [(1,0),(-1,0),(0,1),(0,-1)]:
            nr, nc = cur[0]+dr, cur[1]+dc
            if 0<=nr<n and 0<=nc<m and grid[nr][nc] != 1: # assume 1 is obstacle
                tentative = gscore[cur] + 1
                nxt = (nr,nc)
                if tentative < gscore.get(nxt, float('inf')):
                    gscore[nxt] = tentative
                    came_from[nxt] = cur
                    heapq.heappush(open_set, (tentative + heuristic(nxt, goal), tentative, nxt))
    return None`
  }
];

/* ----------------------------------------------------
   RENDER CARDS (single-column), with accessibility
---------------------------------------------------- */
const listEl = document.getElementById('problemList');
const centerTitle = document.getElementById('problemTitle');
const centerDesc = document.getElementById('problemDesc');
const centerComplexity = document.getElementById('problemComplexity');
const centerCode = document.getElementById('problemCode');
const centerSdgs = document.getElementById('problemSdgs');
const countEl = document.getElementById('count');
const searchInput = document.getElementById('searchInput');

let currentId = null;

function createCardEl(p) {
  const btn = document.createElement('button');
  btn.type = "button";
  btn.className = 'problem-card';
  btn.setAttribute('data-id', p.id);
  btn.setAttribute('aria-pressed', 'false');
  btn.setAttribute('title', p.title);

  // SDG chips markup
  const sdgHtml = (p.sdgs || []).map(s => `<span class="sdg-chip">${escapeHtml(s)}</span>`).join(' ');

  btn.innerHTML = `
    <div class="index">${p.id}</div>
    <div class="body">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h4>${escapeHtml(p.title)}</h4>
        <div class="meta" aria-hidden="true">
          <small>${escapeHtml(p.complexity.split(';')[0])}</small>
        </div>
      </div>
      <div class="meta">${escapeHtml(p.desc)}</div>
      <div class="sdg-chips">${sdgHtml}</div>
      <div class="preview">${previewCode(p.code)}</div>
    </div>
  `;
  btn.addEventListener('click', () => loadProblem(p.id, true));
  btn.addEventListener('keydown', (ev) => {
    if (ev.key === 'Enter' || ev.key === ' ') {
      ev.preventDefault();
      loadProblem(p.id, true);
    }
  });
  return btn;
}

function escapeHtml(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function previewCode(codeStr){
  const lines = String(codeStr||'').split('\n').map(l=>l.trim()).filter(Boolean);
  let out = lines.slice(0,2).join(' ⸱ ');
  if(out.length > 90) out = out.slice(0,87) + '...';
  return escapeHtml(out) || '';
}

function renderCards(items){
  listEl.innerHTML = '';
  const frag = document.createDocumentFragment();
  items.forEach(p => {
    frag.appendChild(createCardEl(p));
  });
  listEl.appendChild(frag);
  countEl.innerText = `${items.length} items`;
}

// load into center panel and highlight
function loadProblem(id, focusCenter=false){
  const p = problems.find(x => x.id === id);
  if(!p) return;
  currentId = id;
  centerTitle.innerText = p.title;
  centerDesc.innerText = p.desc;
  centerComplexity.innerText = p.complexity;
  centerCode.textContent = p.code;
  Prism.highlightElement(centerCode);

  // SDGs in center
  centerSdgs.innerHTML = '';
  if(p.sdgs && p.sdgs.length){
    p.sdgs.forEach(s => {
      const span = document.createElement('span');
      span.className = 'sdg-chip';
      span.innerText = s;
      centerSdgs.appendChild(span);
    });
    centerSdgs.setAttribute('aria-hidden','false');
  } else {
    centerSdgs.setAttribute('aria-hidden','true');
  }

  // active styling
  document.querySelectorAll('.problem-card').forEach(el => {
    const elId = Number(el.getAttribute('data-id'));
    if(elId === id){
      el.classList.add('active');
      el.setAttribute('aria-pressed', 'true');
      el.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
    } else {
      el.classList.remove('active');
      el.setAttribute('aria-pressed', 'false');
    }
  });

  if(focusCenter){
    document.getElementById('center').focus({preventScroll:true});
  }
}

/* -------------------------
   SEARCH & FILTER (FIXED)
   - Includes SDGs in the search
   ------------------------- */
function filter(q){
  const term = String(q||'').trim().toLowerCase();
  if(!term){
    renderCards(problems);
    return;
  }
  const filtered = problems.filter(p => {
    const sdgText = (p.sdgs || []).join(' ');
    const s = `${p.id} ${p.title} ${p.desc} ${p.complexity} ${sdgText}`.toLowerCase();
    return s.includes(term);
  });
  renderCards(filtered);

  // If current selected is not in filtered results, clear center (optional)
  if(currentId){
    const exists = filtered.some(p => p.id === currentId);
    if(!exists){
      centerTitle.innerText = "Select a problem from the left";
      centerDesc.innerText = "Click a problem card to view the explanation.";
      centerComplexity.innerText = "Time Complexity — (select a problem)";
      centerCode.textContent = "# Code will appear here.";
      centerSdgs.innerHTML = '';
      currentId = null;
    }
  }
}

function debounce(fn, wait=180){
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(()=>fn(...args), wait);
  };
}

/* -------------------------
   KEYBOARD NAVIGATION (Up/Down)
   ------------------------- */
document.addEventListener('keydown', (ev) => {
  if(['ArrowDown','ArrowUp'].indexOf(ev.key) === -1) return;
  const cards = Array.from(document.querySelectorAll('.problem-card'));
  if(cards.length === 0) return;
  let idx = cards.findIndex(c => Number(c.getAttribute('data-id')) === currentId);
  if(idx === -1) idx = 0;
  if(ev.key === 'ArrowDown') idx = Math.min(cards.length - 1, idx + 1);
  if(ev.key === 'ArrowUp') idx = Math.max(0, idx - 1);
  const next = cards[idx];
  if(next){
    const id = Number(next.getAttribute('data-id'));
    loadProblem(id, true);
    next.focus({preventScroll:true});
  }
});

/* -------------------------
   INIT
   ------------------------- */
renderCards(problems);
// Optionally auto-open first item:
// loadProblem(problems[0].id, true);

// Search binding (with debounce)
searchInput.addEventListener('input', debounce((e) => {
  filter(e.target.value);
}));

// Expose for debug
window.__DAA = { problems, loadProblem, filter };
</script>

</body>
</html>
