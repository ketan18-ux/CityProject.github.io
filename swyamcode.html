#include <iostream>
#include <vector>
using namespace std;

/* --------------------------
   Linear Regression Model
   AQI = w1*x1 + w2*x2 + ... + b
--------------------------------*/
class LinearRegression {
private:
    vector<double> weights;
    double bias;
    double lr;      // learning rate
    int epochs;

public:
    LinearRegression(int features, double lr = 0.01, int epochs = 1000) {
        weights.resize(features, 0.0);
        bias = 0.0;
        this->lr = lr;
        this->epochs = epochs;
    }

    void train(const vector<vector<double>>& X, const vector<double>& y) {
        int n = X.size();
        int m = weights.size();

        for (int e = 0; e < epochs; e++) {
            vector<double> dw(m, 0.0);
            double db = 0.0;

            for (int i = 0; i < n; i++) {
                double y_pred = bias;
                for (int j = 0; j < m; j++)
                    y_pred += weights[j] * X[i][j];

                double error = y_pred - y[i];

                for (int j = 0; j < m; j++)
                    dw[j] += error * X[i][j];
                db += error;
            }

            for (int j = 0; j < m; j++)
                weights[j] -= lr * dw[j] / n;

            bias -= lr * db / n;
        }
    }

    double predict(const vector<double>& x) {
        double result = bias;
        for (int i = 0; i < x.size(); i++)
            result += weights[i] * x[i];
        return result;
    }
};

/* ------------------------------
   DP-based Smoothing
--------------------------------*/
vector<double> DPSmoothing(const vector<double>& preds, double alpha) {
    int n = preds.size();
    vector<double> smooth(n);

    smooth[0] = preds[0];
    for (int i = 1; i < n; i++)
        smooth[i] = (preds[i] + alpha * smooth[i - 1]) / (1 + alpha);

    return smooth;
}

/* ------------------------------
   Main Function
--------------------------------*/
int main() {

    vector<vector<double>> sensors = {
        {40, 20, 0.5},
        {45, 22, 0.6},
        {50, 24, 0.7},
        {55, 26, 0.8},
        {60, 28, 0.9}
    };

    vector<double> AQI = {90, 95, 100, 110, 120};

    LinearRegression model(3);
    model.train(sensors, AQI);

    vector<double> predictions;
    for (int i = 0; i < sensors.size(); i++)
        predictions.push_back(model.predict(sensors[i]));

    double alpha = 5.0;
    vector<double> smoothAQI = DPSmoothing(predictions, alpha);

    cout << "Raw AQI Predictions:\n";
    for (double v : predictions)
        cout << v << " ";

    cout << "\n\nSmoothed AQI Values:\n";
    for (double v : smoothAQI)
        cout << v << " ";

    return 0;
}
